<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Poly Books</title>
    <link rel="icon" type="image/x-icon" href="assets/img/polyBooks.png" />

    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" rel="stylesheet" />

    <link href="css/styles.css" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="assets/img/logobook.png" />
    <script data-search-pseudo-elements defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body class="nav-fixed">
{{> nav_header}}
<div id="layoutSidenav">
    <!--            Sidebar-->
    {{> sidebar}}
    <!--            End Sidebar-->

    <!--          Start Content-->

    <div id="layoutSidenav_content">
        <main>
            <div class="mx-2 pt-2">
                <div class="card h-auto">
                    <div class="card-header">
                        <div class="dropdown mb-2">
                        <button class="btn btn-light dropdown-toggle" id="dropdownButton" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Hôm nay</button>
                           <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item"  id="today-option">Hôm nay</a>
                            <a class="dropdown-item"  id="week-option">Tuần trước</a>
                            <a class="dropdown-item"  id="month-option">Tháng trước</a>
                            </div>
                        </div>
                        
                        <div class="">
                            <div class="row">
                                <div class="col-sm  mb-2">
                                    <!-- Dashboard info Tai khoan moi-->
                                    <div class="card border-start-lg border-start-primary h-100">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1">
                                                    <div class="uppercase fw-bold text-primary mb-3">Tài khoản mới</div>
                                                    <div class="row">
                                                        <div class="col-3"><i class="fas fa-solid fa-user fa-lg text-gray-200"></i></div>
                                                        <div  id="user-count" class="col-6 ml-1 h5 mt-1">{{statisticalMonth.userToday}}</div>
                                                    </div>

                                                </div>
                                                <!--                                                <div class="ms-2"><i class="fas fa-solid fa-user fa-2x text-gray-200"></i></div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm mb-2">
                                    <!-- Dashboard info Cua hang moi-->
                                    <div class="card border-start-lg border-start-success h-100">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1">
                                                    <div class="uppercase fw-bold text-success mb-3">Cửa hàng mới</div>
                                                    <div class="row">
                                                        <div class="col-3"><i class="fas fa-solid fa-shop fa-lg text-gray-200"></i></div>
                                                        <div id="shop-count" class="col-6 h5 mt-1">{{statisticalToday.shopToday}}</div>
                                                    </div>

                                                </div>
                                                <!--                                                <div class="ms-2"><i class="fas fa-solid fa-shop fa-2x text-gray-200"></i></div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm mb-2">
                                    <!-- Dashboard info Tai khoan moi-->
                                    <div class="card border-start-lg border-start-danger h-100">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1">
                                                    <div class="uppercase fw-bold text-danger mb-3">Sách mới đăng</div>
                                                    <div class="row">
                                                        <div class="col-3"><i class="fas fa-solid fa-book fa-lg text-gray-200"></i></div>
                                                        <div id="book-count" class="col-6 h5 mt-1">{{statisticalMonth.postToday}}</div>
                                                    </div>

                                                </div>
                                                <!--                                                <div class="ms-2"><i class="fas fa-solid fa-check fa-2x text-gray-200"></i></div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm  mb-2">
                                    <!-- Dashboard info Tai khoan moi-->
                                    <div class="card border-start-lg border-start-info h-100">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1">
                                                    <div class="uppercase fw-bold text-info mb-3">Đơn gửi đi</div>
                                                    <div class="row">
                                                        <div class="col-3"><i class="fas fa-solid fa-truck-fast fa-lg text-gray-200"></i></div>
                                                        <div class="col-6 h5 mt-1">223</div>
                                                    </div>

                                                </div>
                                                <!--                                                <div class="ms-2"><i class="fas fa-solid fa-truck-fast fa-2x text-gray-200"></i></div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm  mb-2">
                                    <!-- Dashboard info Tai khoan moi-->
                                    <div class="card border-start-lg border-start-warning h-100">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1">
                                                    <div class="uppercase fw-bold text-warning mb-3">Đơn hoàn thành</div>
                                                    <div class="row">
                                                        <div class="col-3"><i class="fas fa-solid fa-check fa-lg text-gray-200"></i></div>
                                                        <div class="col-6 h5 mt-1">223</div>
                                                    </div>
                                                </div>
                                                <!--                                                <div class="ms-2"><i class="fas fa-solid fa-check fa-2x text-gray-200"></i></div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mx-2 pt-4">
                <div class="col-xl-6 mb-4">
                    <div class="card card-header-actions h-100">
                        <div class="card-header">
                            Sách
                            <div class="dropdown no-caret">
                                <button class="btn btn-transparent-dark btn-icon dropdown-toggle" id="areaChartDropdownExample" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="text-gray-500" data-feather="more-vertical"></i></button>
                                <div class="dropdown-menu dropdown-menu-end animated--fade-in-up" aria-labelledby="areaChartDropdownExample">
                                    <a class="dropdown-item" href="#!">Tuần này</a>
                                    <a class="dropdown-item" href="#!">Tháng này</a>

                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <canvas id="column-chart" width="100%" height="50%"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6 mb-4">
                    <div class="card card-header-actions h-100">
                        <div class="card-header">
                            Đơn hàng
                            <div class="dropdown no-caret">
                                <button class="btn btn-transparent-dark btn-icon dropdown-toggle" id="areaChartDropdownExample" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="text-gray-500" data-feather="more-vertical"></i></button>
                                <div class="dropdown-menu dropdown-menu-end animated--fade-in-up" aria-labelledby="areaChartDropdownExample">
                                    <a class="dropdown-item" href="#!">Hôm nay</a>
                                    <a class="dropdown-item" href="#!">Tuần này</a>
                                    <a class="dropdown-item" href="#!">Tháng này</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-bar">
                                <canvas id="myBarChart" width="100%" height="50%"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row mx-2 pt-4">
                <div class="col-xl-8 mb-4">
                    <div class="card ">
                        <div class="card-header">Thể loại bán chạy nhất</div>
                        <div class="card-body">
                            <table id="datatablesSimple">
                                <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>ID</th>
                                    <th>Tên thể loại</th>
                                    <th>Số lượng</th>
                                </tr>
                                </thead>
                                <tbody>
                                    {{#each categoryCounts}}
                                <tr>
                                    <td id="index{{@index}}"></td>
                                    <td>{{this._id}}</td>
                                    <td>{{this.name}}</td>
                                    <td>{{this.count}}</td>
                                </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                            <script>
                                const tdElements = document.querySelectorAll('td[id^="index"]');
                                tdElements.forEach((td, index) => {
                                    td.textContent = index + 1;
                                });
                            </script>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 mb-4">
                    <!-- Pie chart with legend example-->
                    <div class="card h-100">
                        <div class="card-header">Người dùng</div>
                        <div class="card-body">
                            
                            <div class="chart-pie mb-4 d-flex justify-content-center align-items-center">
                                <canvas id="myPieChart" width="100%" height="50"></canvas>
                            </div>
                           
                            
                            
                            <div class="mt-4 list-group list-group-flush">
                                <div class="list-group-item d-flex align-items-center justify-content-between small px-0 py-2">
                                    <div class="me-3">
                                        <i class="fas fa-circle fa-sm me-1 text-blue"></i>
                                        Người dùng thường
                                    </div>
                                    <div class="fw-500 text-dark">{{regularUserPercentage}}%</div>
                                </div>
                                <div class="list-group-item d-flex align-items-center justify-content-between small px-0 py-2">
                                    <div class="me-3">
                                        <i class="fas fa-circle fa-sm me-1 text-green"></i>
                                        Người dùng VIP
                                    </div>
                                    <div class="fw-500 text-dark">{{vipUserPercentage}}%</div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
                    <-- End Content -->
<script>
    const todayOption = document.getElementById('today-option');
    const weekOption = document.getElementById('week-option');
    const monthOption = document.getElementById('month-option');
    const userCountElement = document.getElementById('user-count');
    const bookCountElement = document.getElementById('book-count');
    const shopCountElement = document.getElementById('shop-count');
    const dropdownButton = document.getElementById('dropdownButton');

    // Hàm cập nhật số lượng người dùng
    function updateUserCount(count) {
        userCountElement.textContent = count;
    }
    function updateBookCount(count) {
        bookCountElement.textContent= count;

    }
    function updateShopCount(count) {
        shopCountElement.textContent = count;

    }

    // Bắt sự kiện cho các lựa chọn trong dropdown
    todayOption.addEventListener('click', () => {
        updateUserCount('{{statisticalToday.userToday}}');
        updateBookCount('{{statisticalToday.postToday}}');
        updateShopCount('{{statisticalToday.shopToday}}');
        dropdownButton.innerHTML = 'Hôm nay';
    });

    weekOption.addEventListener('click', () => {
        updateUserCount('{{statisticalWeek.userWeek}}');
        updateBookCount('{{statisticalWeek.postWeek}}')
        updateShopCount('{{statisticalWeek.shopWeek}}');

        dropdownButton.innerHTML = 'Tuần trước';
    });

    monthOption.addEventListener('click', () => {
        updateUserCount('{{statisticalMonth.userMonth}}');
        updateBookCount('{{statisticalMonth.postMonth}}')
        updateShopCount('{{statisticalMonth.shopMonth}}');

        dropdownButton.innerHTML = 'Tháng trước';
    });

    // Cập nhật nội dung ban đầu cho nút dropdown khi trang web được tải
    document.addEventListener('DOMContentLoaded', () => {
        dropdownButton.innerHTML = 'Hôm nay';
        updateUserCount('{{statisticalToday.userToday}}');
        updateBookCount('{{statisticalToday.postToday}}');
        updateShopCount('{{statisticalToday.shopToday}}');


    });
</script>
<script>
    const regularUserPercentage = {{regularUserPercentage}};
    const vipUserPercentage = {{vipUserPercentage}};
    // Lấy canvas element và khởi tạo biểu đồ pie chart
    const ctx = document.getElementById("myPieChart").getContext("2d");
    const myPieChart = new Chart(ctx, {
        type: "pie",
        data: {
            labels: ["Người dùng thường", "Người dùng VIP"],
            datasets: [{
                data: [regularUserPercentage, vipUserPercentage],
                backgroundColor: ["#007bff", "#28a745"],
            }],
        },
    });
</script>
<script>
    // console.log("day la 7 ngay cua sach thuong")
    // const startOfWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay());
    // const endOfWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay() + 6);
    // // Create an empty map to store the counts
    // const dataThisWeekRegular = {};
    // // Iterate over each day of the week
    // for (let i = 0; i < 7; i++) {
    //     const currentDate = new Date(startOfWeek.getFullYear(), startOfWeek.getMonth(), startOfWeek.getDate() + i);
    //     const nextDate = new Date(startOfWeek.getFullYear(), startOfWeek.getMonth(), startOfWeek.getDate() + i + 1);
    //     // Count posts for the current day
    //     const postsCount = await Post.countDocuments({ createdAt: { $gte: currentDate, $lt: nextDate } });
    //     // Get the day name
    //     const dayName = currentDate.toLocaleDateString('vi-VN', )
    //     // Save the count in the map
    //     dataThisWeekRegular[`${dayName}`] = postsCount
    // }
    // console.log("hahaha"+dataThisWeekRegular);

    const pieChartCtx  = document.getElementById("myPieChart").getContext("2d");
    const myPieChart = new Chart(pieChartCtx, {
    type: "pie",
    data: {
    labels: ["Người dùng thường", "Người dùng VIP"],
    datasets: [{
    data: [regularUserPercentage, vipUserPercentage],
    backgroundColor: ["#007bff", "#28a745"],
    }],
},
});
</script>
{{!-- <script>
    var GroupedbarChartData = {
    labels: {{this.dataThisWeekRegular.label}},
    datasets: [
        {
            label: "Sách bán",
            backgroundColor: "pink",
            borderColor: "pink",
            borderWidth: 1,

            data: [44, 27, 63, 96, 100, 57, 34]


        },
        {
            label: "Sách đấu giá",
            backgroundColor: "blue",
            borderColor: "blue",
            borderWidth: 1,
            data: [44, 27, 63, 96, 100, 57, 34]
        },
        {
            label: "Tổng",
            backgroundColor: "green",
            borderColor: "green",
            borderWidth: 1,
            data: [100, 47, 44, 76, 59, 77, 53]
        }
    ]
}


window.onload = function ()
{
    var chartData= {
        type: "bar",
        data: GroupedbarChartData,
        // options: BarchartOptions
    }
    new Chart("BookGroupedbarChartcanvas", chartData);
};

    
</script>
<script>
    const oderBar = document.getElementById("myBarChart");
    const myBarChart = new Chart(oderBar, {
        type: "bar",
        data: {
            labels: ["Thứ 2", "Thứ 3", "Thứ 4", "Thứ 5", "Thứ 6", "Thứ 7", "Chủ nhật"],
            datasets: [{
                label: "Tổng đơn",
                backgroundColor: "rgba(0, 97, 242, 1)",
                hoverBackgroundColor: "rgba(0, 97, 242, 0.7)",
                borderColor: "#4e73df",
                data: [215, 312, 251, 741, 821, 184, 342],
                maxBarThickness: 25
            },
                {
                    label: "Đơn mua",
                    backgroundColor: "rgba(95, 204, 113, 1)",
                    hoverBackgroundColor: "rgba(95, 204, 113, 0.7)",
                    borderColor: "#4e73df",
                    data: [324, 333, 113, 115, 821, 184, 342],
                    maxBarThickness: 25
                },
                {
                    label: "Đơn bán",
                    backgroundColor: "rgba(255, 113, 0, 1)",
                    hoverBackgroundColor: "rgba(255, 113, 0, 0.7)",
                    borderColor: "#4e73df",
                    data: [324, 333, 113, 115, 821, 184, 342],
                    maxBarThickness: 25
                }]
        },
        options: {
            maintainAspectRatio: false,
            layout: {
                padding: {
                    left: 10,
                    right: 25,
                    top: 25,
                    bottom: 0
                }
            },
            scales: {
                xAxes: [{
                    time: {
                        unit: "Thứ"
                    },
                    gridLines: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        maxTicksLimit: 6
                    }
                }],
                yAxes: [{
                    ticks: {
                        min: 0,
                        maxTicksLimit: 5,
                        padding: 10,
                        // Include a dollar sign in the ticks
                        callback: function (value, index, values) {
                            return "" + number_format(value);
                        }
                    },
                    gridLines: {
                        color: "rgb(234, 236, 244)",
                        zeroLineColor: "rgb(234, 236, 244)",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                    }
                }]
            },
            legend: {
                display: false
            },
            tooltips: {
                titleMarginBottom: 10,
                titleFontColor: "#6e707e",
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: "#dddfeb",
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
                callbacks: {
                    label: function (tooltipItem, chart) {
                        var datasetLabel =
                                chart.datasets[tooltipItem.datasetIndex].label || "";
                        return datasetLabel + ": " + number_format(tooltipItem.yLabel);
                    }
                }
            }
        }
    });
</script>

</script> --}}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="js/scripts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
<script src="js/datatables/datatables-simple-demo.js"></script>
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js" crossorigin="anonymous"></script>
<script src="js/litepicker.js"></script>

</body>
</html>